<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Mastering Django Middlewares: A Guide to Customizing Request and Response Objects | Justin Thomas</title>
<meta name="keywords" content="python, django, middleware">
<meta name="description" content="Introduction We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet&rsquo;s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it&rsquo;s sent to the client.">
<meta name="author" content="Justin Thomas">
<link rel="canonical" href="https://justhomas.in/python/django/middleware-in-django/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b68b6253f90883f71f8b751e883a44ed40fbc3bfd7b3da460ce960a883e3286c.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://justhomas.in/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://justhomas.in/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://justhomas.in/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://justhomas.in/apple-touch-icon.png">
<link rel="mask-icon" href="https://justhomas.in/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Mastering Django Middlewares: A Guide to Customizing Request and Response Objects" />
<meta property="og:description" content="Introduction We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet&rsquo;s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it&rsquo;s sent to the client." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://justhomas.in/python/django/middleware-in-django/" />
<meta property="og:image" content="https://justhomas.in/img/cover.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-17T21:32:23+05:30" />
<meta property="article:modified_time" content="2021-07-17T21:32:23+05:30" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://justhomas.in/img/cover.jpg" />
<meta name="twitter:title" content="Mastering Django Middlewares: A Guide to Customizing Request and Response Objects"/>
<meta name="twitter:description" content="Introduction We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet&rsquo;s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it&rsquo;s sent to the client."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://justhomas.in/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Mastering Django Middlewares: A Guide to Customizing Request and Response Objects",
      "item": "https://justhomas.in/python/django/middleware-in-django/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mastering Django Middlewares: A Guide to Customizing Request and Response Objects",
  "name": "Mastering Django Middlewares: A Guide to Customizing Request and Response Objects",
  "description": "Introduction We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet\u0026rsquo;s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it\u0026rsquo;s sent to the client.",
  "keywords": [
    "python", "django", "middleware"
  ],
  "articleBody": "Introduction We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet’s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it’s sent to the client. All of these can be done with Django middleware. And the best part? There’s probably already a middleware for what you need, whether it’s for rate limiting, logging, caching, or even IP blocking.\nIn this article, we’re going to dive into the world of Django middleware and see how we can use it to add some custom functionality to our app. So, buckle up and get ready to add some extra magic to your app!\nWhat is Django middleware? Django Middleware is a way to hook into the request/response cycle of your django app and modify the request or response before it gets to the view or before it’s sent to the client. It’s a great way to add some extra functionality to your app without having to modify the core code.\nLets say you want to keep track of every request made to your app. You can do this by writing a middleware that logs every request to a file. Or maybe you want to add some custom headers to every response. We can specify the middlewares we want to use in our settings.py file. Django comes with a lot of built-in middlewares that we can use. For example, we can use the built-in middleware CommonMiddleware to add some security headers to our response.\nOnce a request is made to our app, it goes through a series of steps before it gets to the view. These steps are called the request/response cycle. In some part of this cycle, the request is passed to the middleware. The middleware can then modify the request before it gets to the view. Similarly, the response can be modified before it’s sent to the client.\nSome of the Built-in Middlewares Django comes with a lot of built-in middlewares that we can use. Some of the most commonly used middlewares are:\nCommonMiddleware: This middleware adds some security headers to the response. It also adds some other headers like X-Frame-Options and X-Content-Type-Options. It also performs URL rewriting based on the APPEND_SLASH and PREPEND_WWW settings. AuthenticationMiddleware: This middleware is used to authenticate the user. It adds the request.user attribute to the request. This attribute is used to get the currently logged in user. SessionMiddleware: Django provides full support for sessions. The sessions framework allows you to store and retrieve arbitrary data on a per-site-visitor basis. This functionality can be enabled by adding the SessionMiddleware to the MIDDLEWARE setting. This middeware is activated by default in a project created with django-admin startproject.This middleware adds a request.session attribute to the request. This attribute is used to access the session data. How to activate a middleware in Django? To activate a middleware in Django, we need to add it to the MIDDLEWARE setting in our settings.py file. The MIDDLEWARE setting is a list of middleware classes that should be activated for every request. The order of the middleware classes in the list is important. The middleware classes are executed in the order they are listed in the MIDDLEWARE setting.\n# settings.py MIDDLEWARE = [ 'django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', ] The Art of Ordering Middleware in Django: Why It Matters for Your Application When Django recives a request, it applies the middlewares top-down in the order it is mentioned in the settings.py file. Once the request is passed to a MIDDLEWARE it has two options. It can either short-circuit and return a response or it can pass the request to the next middleware.\nIf the middleware returns a response, the request/response cycle is stopped and the response is sent to the client. No other middleware is executed and the request is not passed to the view.\nIf the middleware doesn’t return a response, the request is passed to the next middleware. This process continues until the request is passed to the view. Once the view is executed, the response is passed back to the middleware in the reverse order. i.e. from bottom to top. The middleware can then modify the response before it’s sent to the client.\nThe response will only pass through the middleware that is above the middleware that returned the response. For example, consider the following order of middlewares in the settings.py file.\n# settings.py MIDDLEWARE = [ 'middleware1', 'middleware2', 'middleware3', 'middleware4', 'middleware5', ] If middleware3 short-circuits and returns a response, the response will only pass through middleware1, middleware2 and middleware3. The request is not passed to the view and the response is not passed to the middlewares below middleware3. i.e. middleware4 and middleware5.\nHow to write a middleware in Django? Now that we know what a middleware is and how it can be used, let’s see how we can write a middleware in Django. We’re going to write a middleware that logs every request made to our app. We’re going to use the logging module to log the requests. The logging module is a standard Python module that provides a flexible framework for emitting log messages from Python applications. It’s a great way to log messages to a file or to the console.\n# middleware.py import logging logger = logging.getLogger(__name__) class RequestLoggerMiddleware: def __init__(self, get_response): self.get_response = get_response def __call__(self, request): response = self.get_response(request) logger.info(f\"Request made to {request.path}\") return response The __init__ method is called when the middleware is initialized. The get_response argument is a callable that is used to execute the view. The __call__ method is called when the middleware is called. The __call__ method takes the request as an argument and returns the response. The __call__ method calls the view and then logs the request to the console.\nNow that we have written our middleware, we need to add it to the MIDDLEWARE setting in our settings.py file. We also need to add the logging module to our INSTALLED_APPS setting.\n# settings.py INSTALLED_APPS = [ ... 'django.contrib.messages', 'django.contrib.staticfiles', 'logging', ] MIDDLEWARE = [ ... 'middleware.RequestLoggerMiddleware', ] Now that we have added our middleware to the MIDDLEWARE setting, let’s see how it works. We’re going to make a request to our app and see if the request is logged to the console.\n# views.py from django.http import HttpResponse def index(request): return HttpResponse(\"Hello, world. This request is logged.\") # urls.py from django.contrib import admin from django.urls import path from .views import index urlpatterns = [ path('admin/', admin.site.urls), path('', index, name=\"index\"), ] When a user makes a request to our app, the request is passed to the middleware. The middleware then calls the view and logs the request to the console.\nSummary In this article, we learned about Django middlewares. We saw what a middleware is and how it can be used. We also learned how to write a middleware in Django, how to activate a middleware in Django. Keep in mind that the order of a middleware is important and that the request/response cycle is stopped when a middleware returns a response. Hope you enjoyed this article.\n",
  "wordCount" : "1226",
  "inLanguage": "en",
  "image":"https://justhomas.in/img/cover.jpg","datePublished": "2021-07-17T21:32:23+05:30",
  "dateModified": "2021-07-17T21:32:23+05:30",
  "author":{
    "@type": "Person",
    "name": "Justin Thomas"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://justhomas.in/python/django/middleware-in-django/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Justin Thomas",
    "logo": {
      "@type": "ImageObject",
      "url": "https://justhomas.in/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://justhomas.in/" accesskey="h" title="Justin Thomas (Alt + H)">Justin Thomas</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://justhomas.in/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://justhomas.in/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://justhomas.in/series/" title="Series">
                    <span>Series</span>
                </a>
            </li>
            <li>
                <a href="https://justhomas.in/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://justhomas.in/">Home</a>&nbsp;»&nbsp;<a href="https://justhomas.in/posts/">Posts</a></div>
    <h1 class="post-title">
      Mastering Django Middlewares: A Guide to Customizing Request and Response Objects
    </h1>
<img src="" width="100%">
    <div class="post-meta"><span title='2021-07-17 21:32:23 +0530 IST'>July 17, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Justin Thomas

</div>
  </header> 
<figure class="entry-cover">
        <img loading="lazy" srcset="https://justhomas.in/python/django/middleware-in-django/img/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_1240215_360x0_resize_q75_box.jpg 360w ,https://justhomas.in/python/django/middleware-in-django/img/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_1240215_480x0_resize_q75_box.jpg 480w ,https://justhomas.in/python/django/middleware-in-django/img/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_1240215_720x0_resize_q75_box.jpg 720w ,https://justhomas.in/python/django/middleware-in-django/img/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_1240215_1080x0_resize_q75_box.jpg 1080w ,https://justhomas.in/python/django/middleware-in-django/img/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_1240215_1500x0_resize_q75_box.jpg 1500w ,https://justhomas.in/python/django/middleware-in-django/img/cover.jpg 9000w" 
            sizes="(min-width: 768px) 720px, 100vw" src="https://justhomas.in/python/django/middleware-in-django/img/cover.jpg" alt="" 
            width="9000" height="4320">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#what-is-django-middleware" aria-label="What is Django middleware?">What is Django middleware?</a></li>
                <li>
                    <a href="#some-of-the-built-in-middlewares" aria-label="Some of the Built-in Middlewares">Some of the Built-in Middlewares</a></li>
                <li>
                    <a href="#how-to-activate-a-middleware-in-django" aria-label="How to activate a middleware in Django?">How to activate a middleware in Django?</a></li>
                <li>
                    <a href="#the-art-of-ordering-middleware-in-django-why-it-matters-for-your-application" aria-label="The Art of Ordering Middleware in Django: Why It Matters for Your Application">The Art of Ordering Middleware in Django: Why It Matters for Your Application</a></li>
                <li>
                    <a href="#how-to-write-a-middleware-in-django" aria-label="How to write a middleware in Django?">How to write a middleware in Django?</a></li></ul>
                    
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>We all know that Django is an amazing web framework. It is very easy to use and has a lot of features. One can easily create a web application with Django. But what if you want to add some custom functionality to your application. FLet&rsquo;s say you want to keep track of every request made to your app, or maybe you want to modify the request before it gets to the view or change the response before it&rsquo;s sent to the client. All of these can be done with Django middleware. And the best part? There&rsquo;s probably already a middleware for what you need, whether it&rsquo;s for rate limiting, logging, caching, or even IP blocking.</p>
<p>In this article, we&rsquo;re going to dive into the world of Django middleware and see how we can use it to add some custom functionality to our app. So, buckle up and get ready to add some extra magic to your app!</p>
<h2 id="what-is-django-middleware">What is Django middleware?<a hidden class="anchor" aria-hidden="true" href="#what-is-django-middleware">#</a></h2>
<p>Django Middleware is a way to hook into the request/response cycle of your django app and modify the request or response before it gets to the view or before it&rsquo;s sent to the client. It&rsquo;s a great way to add some extra functionality to your app without having to modify the core code.</p>
<p>Lets say you want to keep track of every request made to your app. You can do this by writing a middleware that logs every request to a file. Or maybe you want to add some custom headers to every response. We can specify the middlewares we want to use in our <code>settings.py</code> file. Django comes with a lot of built-in middlewares that we can use. For example, we can use the built-in middleware <code>CommonMiddleware</code> to add some security headers to our response.</p>
<p>Once a request is made to our app, it goes through a series of steps before it gets to the view. These steps are called the request/response cycle. In some part of this cycle, the request is passed to the middleware. The middleware can then modify the request before it gets to the view. Similarly, the response can be modified before it&rsquo;s sent to the client.</p>
<h2 id="some-of-the-built-in-middlewares">Some of the Built-in Middlewares<a hidden class="anchor" aria-hidden="true" href="#some-of-the-built-in-middlewares">#</a></h2>
<p>Django comes with a lot of built-in middlewares that we can use. Some of the most commonly used middlewares are:</p>
<ul>
<li><strong><code>CommonMiddleware</code></strong>: This middleware adds some security headers to the response. It also adds some other headers like <code>X-Frame-Options</code> and <code>X-Content-Type-Options</code>. It also performs URL rewriting based on the APPEND_SLASH and PREPEND_WWW settings.</li>
<li><strong><code>AuthenticationMiddleware</code></strong>: This middleware is used to authenticate the user. It adds the <code>request.user</code> attribute to the request. This attribute is used to get the currently logged in user.</li>
<li><strong><code>SessionMiddleware</code></strong>: Django provides full support for sessions. The sessions framework allows you to store and retrieve arbitrary data on a per-site-visitor basis. This functionality can be enabled by adding the <code>SessionMiddleware</code> to the <code>MIDDLEWARE</code> setting. This middeware is activated by default in a project created with <code>django-admin startproject</code>.This middleware adds a <code>request.session</code> attribute to the request. This attribute is used to access the session data.</li>
</ul>
<h2 id="how-to-activate-a-middleware-in-django">How to activate a middleware in Django?<a hidden class="anchor" aria-hidden="true" href="#how-to-activate-a-middleware-in-django">#</a></h2>
<p>To activate a middleware in Django, we need to add it to the <code>MIDDLEWARE</code> setting in our <code>settings.py</code> file. The <code>MIDDLEWARE</code> setting is a list of middleware classes that should be activated for every request. The order of the middleware classes in the list is important. The middleware classes are executed in the order they are listed in the <code>MIDDLEWARE</code> setting.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py </span>
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h2 id="the-art-of-ordering-middleware-in-django-why-it-matters-for-your-application">The Art of Ordering Middleware in Django: Why It Matters for Your Application<a hidden class="anchor" aria-hidden="true" href="#the-art-of-ordering-middleware-in-django-why-it-matters-for-your-application">#</a></h2>
<p>When Django recives a request, it applies the middlewares top-down in the order it is mentioned in the <code>settings.py</code> file. Once the request is passed to a <code>MIDDLEWARE</code> it has two options. It can either <strong>short-circuit</strong> and return a response or it can pass the request to the next middleware.</p>
<p>If the middleware returns a response, the request/response cycle is stopped and the response is sent to the client. <strong>No other middleware is executed and the request is not passed to the view.</strong></p>
<p>If the middleware doesn&rsquo;t return a response, the request is passed to the next middleware. This process continues until the request is passed to the view. Once the view is executed, the response is passed back to the middleware in the reverse order. i.e. from bottom to top. The middleware can then modify the response before it&rsquo;s sent to the client.</p>
<p>The response will only pass through the middleware that is above the middleware that returned the response. For example, consider the following order of middlewares in the <code>settings.py</code> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>If <code>middleware3</code> short-circuits and returns a response, the response will only pass through <code>middleware1</code>, <code>middleware2</code> and <code>middleware3</code>. The request is not passed to the view and the response is <strong>not passed to the middlewares below <code>middleware3</code></strong>. i.e. <code>middleware4</code> and <code>middleware5</code>.</p>
<h2 id="how-to-write-a-middleware-in-django">How to write a middleware in Django?<a hidden class="anchor" aria-hidden="true" href="#how-to-write-a-middleware-in-django">#</a></h2>
<p>Now that we know what a middleware is and how it can be used, let&rsquo;s see how we can write a middleware in Django. We&rsquo;re going to write a middleware that logs every request made to our app. We&rsquo;re going to use the <code>logging</code> module to log the requests. The <code>logging</code> module is a standard Python module that provides a flexible framework for emitting log messages from Python applications. It&rsquo;s a great way to log messages to a file or to the console.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># middleware.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RequestLoggerMiddleware</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span> <span class="o">=</span> <span class="n">get_response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Request made to </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></div><p>The <code>__init__</code> method is called when the middleware is initialized. The <code>get_response</code> argument is a callable that is used to execute the view. The <code>__call__</code> method is called when the middleware is called. The <code>__call__</code> method takes the request as an argument and returns the response. The <code>__call__</code> method calls the view and then logs the request to the console.</p>
<p>Now that we have written our middleware, we need to add it to the <code>MIDDLEWARE</code> setting in our <code>settings.py</code> file. We also need to add the <code>logging</code> module to our <code>INSTALLED_APPS</code> setting.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;logging&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middleware.RequestLoggerMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Now that we have added our middleware to the <code>MIDDLEWARE</code> setting, let&rsquo;s see how it works. We&rsquo;re going to make a request to our app and see if the request is logged to the console.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;Hello, world. This request is logged.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># urls.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;index&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>When a user makes a request to our app, the request is passed to the middleware. The middleware then calls the view and logs the request to the console.</p>
<h1 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h1>
<p>In this article, we learned about Django middlewares. We saw what a middleware is and how it can be used. We also learned how to write a middleware in Django, how to activate a middleware in Django. Keep in mind that the order of a middleware is important and that the request/response cycle is stopped when a middleware returns a response. Hope you enjoyed this article.</p>
<!-- ## Some usefull middlewares

- rate limiting middleware
    django-ratelimit



# custom middleware django
django middleware for specific view
authentication middleware in django
what is the use of middleware in django
types of middleware in django
how many middleware are there in django? -->


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://justhomas.in/tags/python/">python</a></li>
      <li><a href="https://justhomas.in/tags/django/">django</a></li>
      <li><a href="https://justhomas.in/tags/middleware/">middleware</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://justhomas.in/python/iterator_in_python/">
    <span class="title">« Prev</span>
    <br>
    <span>Mastering Iterators in Python: Understanding the Iterable and Iterator Protocols</span>
  </a>
  <a class="next" href="https://justhomas.in/posts/data-structures-and-algorithms/dynamic-programming-robbing-house-problem/">
    <span class="title">Next »</span>
    <br>
    <span>From Greedy Guesses to Optimal Solutions: Mastering the House Robber Problem</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on twitter"
        href="https://twitter.com/intent/tweet/?text=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects&amp;url=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f&amp;hashtags=python%2cdjango%2cmiddleware">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f&amp;title=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects&amp;summary=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects&amp;source=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f&title=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on whatsapp"
        href="https://api.whatsapp.com/send?text=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects%20-%20https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on telegram"
        href="https://telegram.me/share/url?text=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects&amp;url=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mastering Django Middlewares: A Guide to Customizing Request and Response Objects on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=Mastering%20Django%20Middlewares%3a%20A%20Guide%20to%20Customizing%20Request%20and%20Response%20Objects&u=https%3a%2f%2fjusthomas.in%2fpython%2fdjango%2fmiddleware-in-django%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://justhomas.in/">Justin Thomas</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
